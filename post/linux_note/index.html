<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>《linux命令行大全与shell脚本编程大全》读书笔记 - Summer&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Summer" /><meta name="description" content="shell脚本编程" /><meta name="keywords" content="linux, shell" />


<meta name="baidu-site-verification" content="QuqVC3Anf0" />



<meta name="generator" content="Hugo 0.68.3 with theme even" />


<link rel="canonical" href="https://summer90xia.github.io/post/linux_note/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.c7bc1becf36bcf6a9ebd25d2947e43a2eb745ddb0c9a32b43126fd7fa460c351.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/">


<meta property="og:title" content="《linux命令行大全与shell脚本编程大全》读书笔记" />
<meta property="og:description" content="shell脚本编程" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://summer90xia.github.io/post/linux_note/" />
<meta property="article:published_time" content="2019-05-11T11:57:27+08:00" />
<meta property="article:modified_time" content="2019-05-11T11:57:27+08:00" />
<meta itemprop="name" content="《linux命令行大全与shell脚本编程大全》读书笔记">
<meta itemprop="description" content="shell脚本编程">
<meta itemprop="datePublished" content="2019-05-11T11:57:27&#43;08:00" />
<meta itemprop="dateModified" content="2019-05-11T11:57:27&#43;08:00" />
<meta itemprop="wordCount" content="3428">



<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="《linux命令行大全与shell脚本编程大全》读书笔记"/>
<meta name="twitter:description" content="shell脚本编程"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Summer&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">栏目</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Summer&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">栏目</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">《linux命令行大全与shell脚本编程大全》读书笔记</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-05-11 </span>
        <div class="post-category">
            <a href="/categories/%E5%AD%A6%E7%94%B5%E8%84%91/"> 学电脑 </a>
            </div>
          <span class="more-meta"> 约 3428 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#基础知识">基础知识</a></li>
        <li><a href="#实用小技巧">实用小技巧</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>本博客是在学习《linux命令行大全与shell脚本编程大全》时做的一些笔记，其中文字部分是从书上摘抄的，代码部分是自己的实践操作。</p>
</blockquote>
<h3 id="基础知识">基础知识</h3>
<h4 id="ps--l-参数值说明"><code>ps -l</code> 参数值说明</h4>
<p><img src="https://blog.summer90.top/images/linux/ps.png" alt=""></p>
<ul>
<li>S 进程的状态 （R-运行，S-休眠，D-可中断的休眠，Z-僵化）</li>
<li>UID 用户系统id</li>
<li>PID 进行ID</li>
<li>PPID 父进程ID</li>
<li><code>PRI 进程优先级</code></li>
<li><code>NI 进程的谦让值</code></li>
<li>TTY 终端设备号在ttylist中的进程</li>
<li>TIME 启动后的占用cpu的时间总量</li>
<li>CMD 启动进程的程序</li>
</ul>
<blockquote>
<p>小技巧  <code>killall http*</code> 结束所有名称中包含 http 的进程</p>
</blockquote>
<p>查找目录下的文件的中是否包含某个字符串 <code>grep -r select ./</code> [ 在当前目录下查找包含select的文件 ]</p>
<h4 id="创建协程-coproc">创建协程 <code>coproc</code></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">coproc my_job <span class="o">{</span> sleep 10<span class="p">;</span> <span class="o">}</span>
<span class="nb">jobs</span>

<span class="c1"># 创建 my_job 协程在后台进行</span>
<span class="c1"># 使用jobs 命令可查看 协程状态</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="linux-环境变量">linux 环境变量</h4>
<ul>
<li>从概念上要区别： 环境变量的全局和局部的含义 和 shell中函数的全局和局部的含义。全局环境变量可理解为系统预设值的变量，所有用户都可以使用，一般采用大写字母命名，如<code>PATH，HOME，USER</code>等，使用<code>printenv</code>可以查看全局变量。局部环境变量只能在定义他们的进程中可见，用户自定义的局部环境变量称为<code>用户定义局部变量</code>，使用 <code>set</code>命令可以查看<code>所有的环境变量</code>。而用户自定义的局部变量相对于函数来说可以理解为全局变量，在整个shell脚本中都可以读取，函数的局部变量设置需要使用<code>local</code>关键字设置。</li>
<li>将用户自定义局部环境变量设置为全局环境变量，需要使用 <code>export</code> 关键字将其导入到全局中去。注意在设置 PATH 全局变量时一定要 追加，不能覆盖。<code>export PATH=$PATH:/$GOROOT/bin</code>。也可以在<code>/etc/.profile.d</code>目录下创建一个<code>.sh</code>文件，把所有的全局变量设置放在其中，这样设置的变量就是全局环境变量，供系统所有用户调用</li>
</ul>
<h4 id="文件权限">文件权限</h4>
<ul>
<li>在<code>/etc/passwd</code>文件中有很多系统账户，这些账户是系统上运行的各种服务进程之间访问资源用的特殊账户，所有运行在后台的服务都需要一个系统用户登录到linux系统上。</li>
<li><code>/etc/shadow</code>对linux系统密码管理提供了更多的控制，如密码过期等，只有root用户才能访问</li>
<li>创建新用户并创建家目录 ，使用 <code>useradd -m summer</code> ,即新增summer用户，并将 <code>/etc/skel</code>目录中个文件复制到<code>/home/summer</code>下，作为summer用户家目录的默认文件</li>
<li>为用户创建密码，并强制下次登录时修改密码，多用于分配账号时，使用命令 <code>passed -e summer</code></li>
<li>删除用户及用户家目录 ，使用 <code>userdel -r summer</code></li>
<li>修改用户 <code>usermod</code>
<ul>
<li>c 修改备注字段</li>
<li>e 修改过期日期</li>
<li>g 修改默认登录组</li>
<li>l 修改用户账户的登录名</li>
<li>L 锁定账户</li>
<li>p 修改账户的密码</li>
<li>U 解除锁定</li>
</ul>
</li>
<li>用户组在 <code>/etc/group</code> 可查看，使用 <code>groupadd</code> 和 <code>groupmod</code>可分别添加和修改组信息</li>
<li><code>chmod</code>、<code>chown</code>、<code>chgrp</code> 可修改文件的 权限，属主，所属组</li>
<li>只有root用户可以更改文件的属主，任何属主都可以改变文件的属组，但是前提是属主必须是原属组和目标属组的成员</li>
</ul>
<h4 id="管理文件系统">管理文件系统</h4>
<ul>
<li>dep 包安装 使用 <code>dpkg -i package</code></li>
<li>apt 仓库的配置文件在 /etc/apt/source.list</li>
<li>vim 编辑器技巧
<ul>
<li>批次替换 : <code>%s /old/new/gc</code> ，将old 用new 替换，g -global 全局 ，c -confirm 替换前要求确认</li>
<li>dd 删除本行 ；5dd 一次删除光标下的5行； dgg 删除本行以上； dG 删除本行以下</li>
</ul>
</li>
</ul>
<h4 id="shell脚本注意事项">shell脚本注意事项</h4>
<ul>
<li>
<p>shell脚本的关键在于：输入多个命令，并处理每个命令的结果，甚至需要将一个命令的结果传给另一个命令</p>
</li>
<li>
<p>日期格式化 <code>date +%Y%m%d</code>  20190204</p>
</li>
<li>
<p>linux支持整型的数学计算，想要进行高级计算，需要使用 bc 或 &ldquo;((  ))&rdquo;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">result</span><span class="o">=</span><span class="k">$(</span>bc <span class="s">&lt;&lt; EOF
</span><span class="s">  scale=4
</span><span class="s">  a=(12*5)
</span><span class="s">  b=(9/3)
</span><span class="s">  a+b
</span><span class="s">EOF</span>
<span class="k">)</span>
  
<span class="c1"># result 的值就是 a+b</span>
<span class="nb">echo</span> <span class="nv">$result</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>内联输入重定向 &laquo;</p>
<blockquote>
<p>将需要工文本中读出来的数据直接用字符的形式关联到命令中，使用 EOF 作为文本标记</p>
</blockquote>
</li>
<li>
<p>两个字符串做比较如果使用 <code>&lt;,&gt;</code> 时，一定要转义，否则shell会将他们当做重定向符号，把字符串当做文件名，并且 if 条件返回 <code>ture</code></p>
</li>
<li>
<p>双 <code>[[]]</code>是 <code>[]</code>的升级版，可以做字符串的高级特性比较。如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 使用正则进行字符匹配</span>
<span class="o">[[</span> <span class="nv">$USER</span> <span class="o">==</span> sum* <span class="o">]]</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>字符串最好使用<strong>双引号</strong>起来</p>
</li>
<li>
<p><code>for</code> 循环的两个方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="k">for</span> index in A B C D
<span class="k">do</span> 
  <span class="nb">echo</span> <span class="nv">$index</span>
<span class="k">done</span>
<span class="c1"># 打印值为 D</span>
<span class="nb">echo</span> <span class="nv">$index</span> 
  
<span class="c1"># for 循环中会保存最后一次迭代的值，可以在for循环的外部使用，也允许改变（跟php的foreach 类似）</span>
  
<span class="c1"># c 语言风格的for</span>
<span class="c1"># 虽然可以定义多个变量，但是只能以一个作为条件</span>
<span class="c1"># 在这里允许变量赋值有空格</span>
<span class="k">for</span> <span class="o">((</span> <span class="nv">a</span> <span class="o">=</span> 10,b<span class="o">=</span>1<span class="p">;</span> b&lt;10<span class="p">;</span> a--,b++  <span class="o">))</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$a</span><span class="s2"> ~~ </span><span class="nv">$b</span><span class="s2">&#34;</span>
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>遍历目录文件时，必须使用通配符，它会强制shell使用文件扩展匹配。扩展匹配会将解析的后的数据作为 遍历的对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="k">for</span> file in ./*
<span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">$file</span>
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在 循环语句后面加 <code>&gt; out.txt</code> 会将结果重定向到文件中</p>
</li>
<li>
<p>在第9个参数之后，必须加上花括号，如 ${10} 表示第 10 个参数</p>
</li>
<li>
<p>basename 返回不包含路径的脚本名</p>
</li>
<li>
<p>获取脚本参数个数 使用 <code>$#</code> ，获取最后一个参数使用 <code>${!#}</code></p>
</li>
<li>
<p>遍历脚本参数，使用 <code>$@</code> 获取所有的参数，<code>$@</code>会将所有参数分开存储，便于迭代</p>
</li>
<li>
<p>使用 <code>$$</code> 变量表示系统分配给该脚本的 PID</p>
</li>
<li>
<p>接收用户输入信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">echo</span> -n <span class="s2">&#34;what&#39;s your name?&#34;</span><span class="p">;</span>
<span class="nb">read</span> name
<span class="nb">echo</span> <span class="s2">&#34;hello </span><span class="nv">$name</span><span class="s2">&#34;</span>
  
<span class="nb">read</span> -p <span class="s2">&#34;how old are you?&#34;</span> age
<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$age</span><span class="s2">&#34;</span>
  
<span class="nb">read</span> -s -p <span class="s2">&#34;enter you password&#34;</span> password
<span class="nb">echo</span> <span class="s2">&#34;你的密码是</span><span class="nv">$password</span><span class="s2">&#34;</span>
  
<span class="c1"># 输入对话框</span>
<span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
    <span class="nb">read</span> -p <span class="s2">&#34;Do you wish to install this program?&#34;</span> yn
    <span class="k">case</span> <span class="nv">$yn</span> in
        <span class="o">[</span>Yy<span class="o">]</span>* <span class="o">)</span> <span class="nb">echo</span> <span class="s2">&#34;yes&#34;</span><span class="p">;</span>break<span class="p">;;</span>
        <span class="o">[</span>Nn<span class="o">]</span>* <span class="o">)</span> <span class="nb">echo</span> <span class="s2">&#34;no&#34;</span><span class="p">;</span>exit<span class="p">;;</span>
        * <span class="o">)</span> <span class="nb">echo</span> <span class="s2">&#34;Please answer yes or no.&#34;</span><span class="p">;;</span>
    <span class="k">esac</span>
<span class="k">done</span>
  
  
<span class="c1"># 选择对话框</span>
<span class="nb">echo</span> <span class="s2">&#34;Do you wish to install this program?&#34;</span>
<span class="k">select</span> yn in <span class="s2">&#34;Yes&#34;</span> <span class="s2">&#34;No&#34;</span><span class="p">;</span> <span class="k">do</span>
    <span class="k">case</span> <span class="nv">$yn</span> in
        Yes <span class="o">)</span> <span class="nb">echo</span> yes<span class="p">;</span> break<span class="p">;;</span>
        No <span class="o">)</span> <span class="nb">echo</span> no<span class="p">;</span>exit<span class="p">;;</span>
    <span class="k">esac</span>
<span class="k">done</span>
  
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>每次调用read命令时，它都会从文件中读取一行文本，直到没有内容时，read命令返回 非0 状态码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 遍历文件的每一行</span>
<span class="nv">nu</span><span class="o">=</span><span class="m">1</span>
cat test.txt <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> line
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">&#34;第</span><span class="nv">$nu行的内容是$line</span><span class="s2">&#34;</span>
  <span class="nv">nu</span> <span class="o">=</span> $<span class="o">[</span><span class="nv">$nu</span>+1<span class="o">]</span>
<span class="k">done</span>
  
  
<span class="c1"># 遍历文件中的数据</span>
<span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read</span> -r key value
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">&#34;the key is </span><span class="nv">$key</span><span class="s2">&#34;</span>
  <span class="nb">echo</span> <span class="s2">&#34;the value is </span><span class="nv">$value</span><span class="s2">&#34;</span>
<span class="k">done</span> &lt; <span class="s2">&#34;input.csv&#34;</span>
  
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>获取命令参数</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 注意 $* 和 $@ 的区别，这里使用 $@ 做例子</span>

<span class="c1"># 获取参数</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$#</span> -eq <span class="m">0</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&#34;参数缺失&#34;</span>
  <span class="nb">exit</span> <span class="m">2</span>
<span class="k">fi</span>

<span class="nv">index</span><span class="o">=</span><span class="m">1</span>
<span class="k">for</span> param in <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">&#34;第</span><span class="nv">$index个参数是</span><span class="s2">:</span><span class="nv">$param</span><span class="s2">&#34;</span>
  <span class="nv">index</span><span class="o">=</span>$<span class="o">[</span><span class="nv">$index</span>+1<span class="o">]</span>
<span class="k">done</span>

<span class="c1"># 获取命令选项值</span>
<span class="k">while</span> <span class="nb">getopts</span> <span class="s1">&#39;d:p:k&#39;</span> opt<span class="p">;</span> 
<span class="k">do</span>  
    <span class="k">case</span> <span class="si">${</span><span class="nv">opt</span><span class="si">}</span> in
        d<span class="o">)</span>
            <span class="nv">date</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OPTARG</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;;</span>
        p<span class="o">)</span>
            <span class="nv">platform</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">OPTARG</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;;</span>
           k<span class="o">)</span> 
               <span class="nv">haveKey</span><span class="o">=</span><span class="s2">&#34;true&#34;</span><span class="p">;;</span>
        ?<span class="o">)</span>
            <span class="nb">echo</span> <span class="s2">&#34;Usage: `basename </span><span class="nv">$0</span><span class="s2">` [options] filename&#34;</span>
      <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">esac</span>
    <span class="nb">echo</span> <span class="s2">&#34;opt is &#34;</span><span class="si">${</span><span class="nv">opt</span><span class="si">}</span><span class="s2">&#34;, arg is &#34;</span><span class="si">${</span><span class="nv">OPTARG</span><span class="si">}</span><span class="s2">&#34;, after index is &#34;</span><span class="si">${</span><span class="nv">OPTIND</span><span class="si">}</span>    
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>清空文件或避免出现错误信息，可使用 /dev/null 重定向 输入或输出</p>
</li>
<li>
<p>将脚本中的错误信息（文件描述符为<code>2</code>）重定向到错误日志中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># use ./error.sh 2 &gt; error.txt</span> 
  
<span class="nb">echo</span> <span class="s2">&#34;This is a misstake 1&#34;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="nb">echo</span> <span class="s2">&#34;This is is a normal txt&#34;</span>
  
<span class="nb">echo</span> <span class="s2">&#34;This is a misstake 2&#34;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="nb">echo</span> <span class="s2">&#34;This is a misstake 3&#34;</span>
  
<span class="nb">echo</span> <span class="s2">&#34;This is is a normal txt&#34;</span>
<span class="nb">echo</span> <span class="s2">&#34;This is a misstake 4&#34;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
  
<span class="nb">echo</span> <span class="s2">&#34;This is a misstake 5&#34;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="nb">echo</span> <span class="s2">&#34;This is is a normal txt&#34;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>永久重定向，使用exec制定某个特定</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 将标准输出重定向到 out.txt 中</span>
<span class="nb">exec</span> <span class="m">1</span> &gt; out.txt 
  
<span class="c1"># 将错误信息重定向到 err.txt 中</span>
<span class="nb">exec</span> <span class="m">2</span> &gt; err.txt
  
<span class="c1"># 将 conf.txt 的内容作为标准输入</span>
<span class="nb">exec</span> <span class="m">0</span> &lt; conf.txt
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong><code>nohup</code></strong></p>
<ul>
<li>nohup 命令运行了另外一个命令来阻断所有发送给该进程的 <code>SIGHUP</code>信号，以阻止在退出终端时导致进程退出</li>
<li>为了保存该命令产生的输出，nohup 命令会自动将 <code>STOUT</code>*[标准输出]* 和 <code>STDERR</code>*[错误信息]* 重定向到一个名为 nohup.out 的文件中</li>
</ul>
</li>
<li>
<p><code>crontab</code>  定时任务</p>
<ul>
<li>-e 编辑</li>
<li>-l 查看</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 设置脚本在本月的最后一天的12点钟执行</span>

crontab -e 

<span class="m">00</span> <span class="m">12</span> * * * <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span>date +%d -d tomorrow<span class="sb">`</span> <span class="o">=</span> <span class="m">01</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span> <span class="p">;</span> <span class="nb">command</span> <span class="p">;</span> <span class="k">fi</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>也可以将脚本放在 /etc/cron.* 目录中，会根据目录名自动执行</li>
<li>anacron 命令会尽快运行<strong>错过执行时间</strong>的脚本</li>
</ul>
<p><strong><code>函数</code></strong></p>
<ul>
<li>
<p>创建函数的两种方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="k">function</span> name <span class="o">{</span>
    commands
<span class="o">}</span>
  
name<span class="o">(){</span>
    commands
<span class="o">}</span>
  
name
  
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>shell 函数注意事项</p>
<ul>
<li>使用 关键字<code>function</code>创建函数时，<code>name</code> 和 <code>{</code> 之间一定要有空格</li>
<li>函数调用只需要写函数名即可，不需要带 <code>()</code></li>
<li>函数传参，参数直接接在 函数名后面 如 ：sum 10 20  表示给 sum 函数传递 10,20 两个参数</li>
<li>函数申明必须在调用的前面</li>
<li>函数名必须是唯一的，不然后面的会直接覆盖前面的，并且不会有任何的报错信息</li>
<li>函数的退出状态码必须在 0~255 之间</li>
<li>可以使用命令替换的方法将函数的返回值赋值给一个变量，如 <code>*result=$(func); echo $result*</code></li>
<li>shell 函数return 关键字用于自定义输出函数的状态码，返回int类型，用<code>$?</code>查看。与其他语言的<code>return</code>有所不同</li>
<li>函数参数的作用域。不能直接使用脚本在命令行中的参数，必须在函数调用的时候手动传过去</li>
<li>在脚本中定义的变量是全局变量，可以在函数中正常访问并对其进行修改</li>
<li>使用 <code>local</code> 关键字，保证变量只能在函数内部使用。&mdash;- <code>局部变量</code></li>
<li>如果将数组变量作为函数参数，函数只会取数组变量的第一个值。要解决这个问题可以将数组的值分解为单个值，然后作为参数传入，在函数内部在重组。 <code>arr=($(echo &quot;$@&quot;))</code></li>
<li>数组求和 ： <code>addarray</code></li>
<li><strong>函数导入</strong> ： 使用 source，可简写为 . 如 . ./myfuncs 。表示引入当前目录下的 myfuncs 文件中的 函数</li>
</ul>
</li>
<li>
<p>mktemp 命令可以在 /tmp 目录中创建一个临时文件。 <code>mktemp test.xxxxxx</code> ，6个x会被替换成6个字符，从而保证文件名唯一</p>
</li>
<li>
<p>sed ：stream editor （流编辑器） ，会在编辑器处理数据之前基于预先提供的一组规则来编辑数据流。它不会修改文件的内容，只会将修改后的数据发送到标准输出</p>
</li>
<li>
<p>gawk 是一种编程语言，语法格式 <code>gawk '{  print &quot;hello&quot; }'</code></p>
</li>
</ul>
<hr>
<h3 id="实用小技巧">实用小技巧</h3>
<h4 id="将远程服务器上的文件复制到本地">将远程服务器上的文件复制到本地</h4>
<blockquote>
<p><strong>scp -r <a href="mailto:root@45.63.55.186">root@45.63.55.186</a>:/root/go/ngrok/bin/ngrok /usr/local/bin</strong></p>
</blockquote>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Summer</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-05-11
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/os/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">计算机操作系统基本原理笔记</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/wechat_auth/">
            <span class="next-text nav-default">微信授权登录</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://summer90xia.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2016 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>Summer</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js" integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js" integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js" integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js" integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js" integrity="sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css" integrity="sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF" crossorigin="anonymous">



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?fc8cf18648f58ac4ad0594547ec6c1e3";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>

<script id="baidu_push">
  (function(){
    if (window.location.hostname === 'localhost') return;
    var bp = document.createElement('script'); bp.async = true;
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


<script src="/js/"></script>


</body>
</html>
